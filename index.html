<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="UTF-8">
  <title>Rock Paper Scissors
  </title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
  <div class="container">
    <div class="jumbotron">
      <h1 class="display-4">Guess the final fantasy 7 character</h1>
    
      <div id="game">
        <h3> Press any key to begin!</h3>
      </div>
      <div id="guesses">

      </div>
      <div id="misses">

      </div>
      <div id="stats">

      </div>
    </div>
    
  </div>
  

  <script type="text/javascript">
    //initialize game stats to 0
    var wins = 0, losses = 0, guessLeft = 0;
    // array of all possible inputs
    var word = "";
    var feedback = [];
    var playerGuesses = "";
    var concatFeedback = ""
    var play = 0;
    var possibleWords = [];
    function loadWords()
    {
      possibleWords = ["cloud", "barret", "tifa", "aerith", "sephiroth", "yuffie", "vincent"]
    }
    loadWords();

    function getAllIndexes(arr, val) {
      var indexes = [], i = -1;
      while ((i = arr.indexOf(val, i+1)) != -1){
        indexes.push(i);
      }
      return indexes;
    }

    function updateGuess(){
      concatFeedback = "";
      for(let j = 0; j < feedback.length; j++)
      {
        concatFeedback += feedback[j];
      }
    }

    function clearScreen(){
      document.getElementById("game").innerHTML = ""; 
      document.getElementById("guesses").innerHTML = "";
      document.getElementById("misses").innerHTML = "";
      document.getElementById("stats").innerHTML = "";
    }

    function writeWord2Guess(){
      var output = "";
      for(let i in concatFeedback)
      {
        output += concatFeedback[i] + " ";
      }
      document.getElementById("game").innerHTML = output + " " + String(wins);
    }

    function writeWin(){    
      document.getElementById("game").innerHTML = "You Win! Press any key to restart" + "<br>" + 
                                                  "The word was: " + word;
    }

    function writeLoss(){    
      document.getElementById("game").innerHTML = "You Lose! Press any key to restart" + "<br>" + 
                                                  "The word was: " + word;
    }

    function writePlayerGuesses(){      
      document.getElementById("guesses").innerHTML = playerGuesses;
      document.getElementById("misses").innerHTML = "Misses left: " + String(guessLeft);
    }

    function writeStats(){   
      document.getElementById("stats").innerHTML = "Wins: " + String(wins) + "  Losses: " + String(losses);
    }

    function checkWin(){
      if(concatFeedback == word)
      {
        return true;
      }
      return false;
    }
    function checkLoss(){
      if(guessLeft == 0)
      {
        return true;
      }
      return false;
    }
    function getNewWord()
    {
      return possibleWords[Math.floor(Math.random() * possibleWords.length)]
    }
    
    function initGame(){

      word = getNewWord();
      feedback = [];
      for(let i = 0; i < word.length; i++)
      {
        feedback.push("_");
      }
      playerGuesses = "";
      concatFeedback = ""

      guessLeft = 5;
      play = 1;
    }
    

    
    
    // listen for user input
    document.onkeyup = function(event) {
      var userInput = event.key;
      if(play == 0)
      {
        initGame();
      }
      // extract user input
     
    
      // includes checks if string that method is called on is in the array provided as input
      // limits the input to only valid throws
      if(!(playerGuesses.includes(userInput)) && play == 1)
      {
        playerGuesses += userInput + " ";
        if(word.includes(userInput))
        {
          
          var indexes = getAllIndexes(word, userInput);
          for(let i in indexes)
          {
            feedback[indexes[i]] = userInput;
          }

          updateGuess();

          if(checkWin())
          {
            ++wins;
            play = 3
          }
          
          
        }
        else{
          --guessLeft;
          if(checkLoss())
          {
            ++losses;
            play = 2;
          }
        }
        updateGuess();
        writeWord2Guess();
        writePlayerGuesses();
        writeStats();
      }

      if(play != 1)
      {
        clearScreen();
        if(play == 3)
        {
          writeWin();
        }
        else
        {
          writeLoss();
        }
        writeStats();
        play = 0;
      }
    };
  </script>

</body>

</html>
